<script>
const repoOwner = window.location.hostname.split('.')[0];
const repoName = `${repoOwner}.github.io`;

async function fetchReleases() {
  const apiURL = `https://api.github.com/repos/${repoOwner}/${repoName}/releases`;
  try {
    const response = await fetch(apiURL);
    if (!response.ok) throw new Error(`GitHub API error: ${response.status}`);
    const releases = await response.json();

    const tbody = document.getElementById("apk-list");
    tbody.innerHTML = "";

    releases.forEach(release => {
      release.assets.forEach(asset => {
        const fileName = asset.name.toLowerCase();
        const date = new Date(asset.updated_at).toLocaleDateString("ru-RU", {
          day: "numeric", month: "long", year: "numeric"
        });

        let iconSrc = "images/unknown.png";
        if (fileName.endsWith(".apk")) iconSrc = "images/android.png";
        else if (fileName.endsWith(".zip")) iconSrc = "images/windows.png";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td data-label="Файл">${asset.name}</td>
          <td data-label="Дата загрузки">${date}</td>
          <td data-label="Платформа"><img src="${iconSrc}" alt="Платформа" class="icon"></td>
          <td data-label="Скачать"><a href="${asset.browser_download_url}" class="download-btn">Скачать</a></td>
        `;
        tbody.appendChild(tr);
      });
    });

    if (tbody.innerHTML === "") {
      tbody.innerHTML = `<tr><td colspan="4">Файлы не найдены</td></tr>`;
    }

  } catch (error) {
    document.getElementById("apk-list").innerHTML = `<tr><td colspan="4">Ошибка загрузки: ${error.message}</td></tr>`;
  }
}

fetchReleases();

// Локализация
let lang = localStorage.getItem("lang") || "ru";
const langBtn = document.getElementById("lang-toggle");

const text = {
  ru: {
    h1: "Скачать — Ekrapina Sandbox",
    driveText: "Не нашли старые версии?",
    driveBtn: "Скачать старые версии из Google Drive",
    flag: "images/flag_ru.png",
    alt: "Русский"
  },
  en: {
    h1: "Download — Ekrapina Sandbox",
    driveText: "Can't find old versions?",
    driveBtn: "Download old versions from Google Drive",
    flag: "images/flag_us.png",
    alt: "English"
  }
};

function applyLanguage() {
  document.querySelector(".header").childNodes[0].nodeValue = text[lang].h1;
  document.querySelector(".drive-text").textContent = text[lang].driveText;
  document.querySelector(".drive-btn span").textContent = text[lang].driveBtn;
  const img = langBtn.querySelector("img");
  img.src = text[lang].flag;
  img.alt = text[lang].alt;
  localStorage.setItem("lang", lang);
}

langBtn.addEventListener("click", () => {
  lang = lang === "ru" ? "en" : "ru";
  applyLanguage();
});

applyLanguage();
</script>
